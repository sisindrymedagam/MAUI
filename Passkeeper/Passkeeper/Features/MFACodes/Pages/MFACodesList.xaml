<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:icon="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             xmlns:views="clr-namespace:Passkeeper.Features.MFACodes.Views"
             xmlns:components="clr-namespace:Passkeeper.Components"
             xmlns:helpers="clr-namespace:Passkeeper.Helpers"
             x:Class="Passkeeper.Features.MFACodes.Pages.MFACodesList"
             Title="Authenticator Codes">
    
    <ContentPage.Resources>
        <ResourceDictionary>
            <helpers:IsCollectionEmptyConverter x:Key="IsCollectionEmptyConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>
    
    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Empty State -->
        <Label Grid.Row="0"
               Text="No authenticator codes yet. Tap + to add your first code."
               IsVisible="{Binding MFACodes.Count, Converter={StaticResource IsCollectionEmptyConverter}}"
               FontSize="18"
               HorizontalOptions="Center" 
               VerticalOptions="Center" 
               Padding="20"
               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
        
        <!-- MFA Codes List -->
        <RefreshView Grid.Row="1" 
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}">
            <CollectionView ItemsSource="{Binding MFACodes}"
                           SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems Mode="Reveal">
                                    <SwipeItem Text="Delete" 
                                              BackgroundColor="Red" 
                                              CommandParameter="{Binding .}" 
                                              Invoked="OnDeleteMFACode"/>
                                    <SwipeItem Text="Edit" 
                                              BackgroundColor="Orange" 
                                              CommandParameter="{Binding .}" 
                                              Invoked="OnEditMFACode"/>
                                </SwipeItems>
                            </SwipeView.RightItems>
                            <views:MFACodeItemView />
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
        
        <!-- Floating Action Button -->
        <Button Grid.Row="2"
                icon:MauiIcon.Value="{icon:Fluent Icon=Add24, IconSize=30, IconColor=White}"
                TextColor="White"
                FontSize="32"
                BackgroundColor="#512BD4"
                WidthRequest="64"
                HeightRequest="64"
                CornerRadius="50"
                VerticalOptions="End"
                HorizontalOptions="End"
                Margin="24" 
                Clicked="OnAddCodeClicked"
                ToolTipProperties.Text="Add new authenticator code">
            <Button.Shadow>
                <Shadow Brush="#40000000"
                        Offset="0,5"
                        Radius="10"
                        Opacity="0.5" />
            </Button.Shadow>
        </Button>
        
        <!-- Add Code Bottom Sheet -->
        <components:BottomSheetComponent x:Name="AddCodePanel" 
                                        OnShow="HideTabBar" 
                                        OnHidden="ShowTabBar">
            <components:BottomSheetComponent.SheetContent>
                <VerticalStackLayout Padding="20" Spacing="20">
                    
                    <Label Text="Add Authenticator Code" 
                           FontSize="24" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                    
                    <Label Text="Enter the details for your authenticator code" 
                           FontSize="14"
                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                    
                    <Entry x:Name="NameEntry" 
                           Placeholder="Account Name (e.g., Google, GitHub)"
                           PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                    
                    <Entry x:Name="IssuerEntry" 
                           Placeholder="Issuer (optional)"
                           PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                    
                    <Entry x:Name="SecretEntry" 
                           Placeholder="Secret Key"
                           PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                    
                    <HorizontalStackLayout Spacing="12">
                        <Button Text="Cancel" 
                                Style="{StaticResource SecondaryButton}"
                                HorizontalOptions="FillAndExpand"
                                Clicked="OnCancelAdd" />
                        <Button Text="Add Code" 
                                Style="{StaticResource PrimaryButton}"
                                HorizontalOptions="FillAndExpand"
                                Clicked="OnConfirmAdd" />
                    </HorizontalStackLayout>
                    
                </VerticalStackLayout>
            </components:BottomSheetComponent.SheetContent>
        </components:BottomSheetComponent>
        
    </Grid>
    
</ContentPage>