<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Loop.MAUI.MainPage"
             xmlns:ctk="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             Title="Loop Kids"
             xmlns:icon="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             Shell.NavBarIsVisible="False" 
             Shell.FlyoutItemIsVisible="False" 
             Shell.TabBarIsVisible="False">

    <Grid x:Name="RootGrid">
        <Grid VerticalOptions="Center"
          HorizontalOptions="Center"
              HeightRequest="{Binding Source={x:Reference RootGrid}, Path=Height}"
          WidthRequest="{Binding Source={x:Reference RootGrid}, Path=Height, Converter={StaticResource AspectRatioConverter}, ConverterParameter=9:16}">
            <!-- Full screen video -->
            <ctk:MediaElement x:Name="Player"
                          Source="{Binding CurrentVideo.URL}"
                          ShouldAutoPlay="True"
                          ShouldLoopPlayback="True"
                              ShouldKeepScreenOn="True"
                          ShouldShowPlaybackControls="False"
                          Aspect="AspectFill"
                          VerticalOptions="Fill"
                          HorizontalOptions="Fill" />

            <!-- Center play icon (shown only when paused) -->
            <Image x:Name="PlayOverlay"
                   Source="{icon:Fluent Icon=PlayCircle24, IconSize=64, IconColor=#FFFFFF}"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   Opacity="0"
                   IsVisible="False">
                <Image.Shadow>
                    <Shadow Brush="Black"
    Offset="2,2"
    Radius="8"
    Opacity="0.8" />
                </Image.Shadow>
            </Image>
        </Grid>

        <!-- Custom transparent toolbar overlay -->
        <Grid VerticalOptions="Start"
      HeightRequest="56"
      Padding="10,0"
      BackgroundColor="Transparent">

            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#66000000" Offset="0.0" />
                    <GradientStop Color="Transparent" Offset="1.0" />
                </LinearGradientBrush>
            </Grid.Background>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Title -->
            <Label Text="Loop Kids"
           Grid.Column="0"
           TextColor="White"
           FontAttributes="Bold"
           FontSize="18"
           VerticalOptions="Center"
           HorizontalOptions="Start"/>

            <!-- Settings button -->
            <ImageButton Grid.Column="1"
                 Source="{icon:Fluent Icon=Settings20, IconSize=20, IconColor=#FFFFFF}"
                 BackgroundColor="Transparent"
                         Clicked="NavigateToSettings"
                 WidthRequest="36"
                 HeightRequest="36"
                 Padding="8"
                 VerticalOptions="Center"
                 HorizontalOptions="End"/>
        </Grid>

        <!-- Overlay bottom details -->
        <Grid VerticalOptions="End"
              BackgroundColor="Transparent">

            <!-- Gradient for readability -->
            <BoxView HeightRequest="120"
                     VerticalOptions="End"
                     Opacity="0.5">
                <BoxView.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="Transparent" Offset="0.0" />
                        <GradientStop Color="#000000" Offset="1.0" />
                    </LinearGradientBrush>
                </BoxView.Background>
            </BoxView>

            <!-- Text overlay -->
            <VerticalStackLayout VerticalOptions="End" Padding="10" Spacing="4">
                <Label Text="{Binding PlayPosition}"
               TextColor="White"
               FontSize="12"
               FontAttributes="Bold"
               HorizontalOptions="Start" />
                <Label Text="{Binding CurrentVideo.Name}"
                       TextColor="White"
                       x:Name="VideoTitleLabel"
                       FontSize="14"
                       Padding="0,0,0,5"
                       FontAttributes="Bold"
                       LineBreakMode="TailTruncation" />
            </VerticalStackLayout>
        </Grid>
        <!-- Attach swipe gestures to Grid (not ContentPage) -->
        <Grid.GestureRecognizers>
            <SwipeGestureRecognizer Direction="Up" Command="{Binding NextCommand}" />
            <SwipeGestureRecognizer Direction="Down" Command="{Binding PreviousCommand}" />
            <TapGestureRecognizer Tapped="OnVideoTapped" />
        </Grid.GestureRecognizers>
    </Grid>

</ContentPage>